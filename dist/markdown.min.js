/* eslint-disable */
const parseBoolean=(e,t)=>"boolean"==typeof e?e:t,parseMaxHeader=(e,t)=>Number.isInteger(e)&&e>=1&&e<=6?e:t,MD_ESCAPE_CHAR="\\",MD_CHARS=["*","[","`","!","#","~","^"].join(""),REGEX_ESCAPE_CHAR=new RegExp(`\\\\([${MD_CHARS}])`,"g"),removeEscapeChars=e=>e.replace(REGEX_ESCAPE_CHAR,(e,t)=>t),REGEX_MD_TEXT=new RegExp(`[${MD_CHARS}]`),attach=function(){for(const e of this.children)e._attach&&e._attach(e);this.onAttach&&this.onAttach(this)};const parse=(e,t={})=>{const n=parseBoolean(t.allowHeader,!0),l=parseBoolean(t.allowLink,!0),o=parseBoolean(t.allowImage,!0),s=parseBoolean(t.allowImageStyle,!1),a=parseBoolean(t.allowCode,!0),i=parseBoolean(t.allowMultilineCode,!0),d=parseBoolean(t.allowUnorderedList,!0),r=parseBoolean(t.allowUnorderedNestedList,!0),c=parseBoolean(t.allowOrderedList,!0),p=parseBoolean(t.allowOrderedNestedList,!0),f=parseBoolean(t.allowHorizontalLine,!0),h=parseBoolean(t.allowQuote,!0),u=parseBoolean(t.allowReference,!0),C=(g=t.maxHeader,E=3,Number.isInteger(g)&&g>=1&&g<=6?g:E);var g,E;const x=t.document||window.document,A=e=>{const t=x.createElement(e);return t._attach=attach,t},O=x.createElement("div");let L=0;const b=e+"\n",N=b.length;let m,R,I,w,B;const T=()=>{null!=m&&(O.appendChild(m),O.lastChild._attach(),m=null,R=null)},U=()=>{if(null==R&&(m=A("P"),R=m),I<w){const e=removeEscapeChars(B.substring(I,w));R.appendChild(x.createTextNode(e)),I=w}},_=e=>B[w+e];for(;L<N;){const e=b.substring(L),g=e.indexOf("\n");B=e.substring(0,g);let E=g+1,x=!1;if(0===B.trim().length)null!=m&&"P"===m.tagName&&T();else{w=0,I=0;let e=!0;const O=B[0];if("\\"===O)w=1;else if(n&&"#"===O){let n=1;for(;n<C&&"#"===_(n);)n+=1;if(" "===_(n)){T();const l=B.substring(B.indexOf(" ")+1),o=A("H"+n);o.textContent=l,o.onAttach=t.onHeader,m=o,e=!1,T()}}else if("!"===O){if("["===_(1)&&o){const n=B.substring(w+1),l=/^\[([^\]]+)]\(([^;)]+)(;([^)]+))?\)$/.exec(n);if(l){T();const n=l[1],o=l[2],a=l[4],i=A("FIGURE");s&&null!=a&&i.setAttribute("style",a);if(o.endsWith(".mp4")){const e=A("SOURCE");e.setAttribute("src",o),e.setAttribute("type","video/mp4");const n=A("VIDEO");n.appendChild(e),n.setAttribute("controls",""),n.onAttach=t.onVideo,i.appendChild(n)}else{const e=A("IMG");e.setAttribute("src",o),e.setAttribute("alt",""),e.onAttach=t.onImage,i.appendChild(e)}const d=A("FIGCAPTION");d.textContent=n,i.appendChild(d),m=i,e=!1,T()}}}else if("-"===O){if(f&&"---"===B&&"\n"===b[L-2]&&"\n"===b[L-1]&&"\n"===b[L+3]&&"\n"===b[L+4]){T();const n=A("HR");n.onAttach=t.onHorizontalLine,m=n,e=!1,T()}else if(d&&" "===_(1)){if(null!=m&&"UL"!==m.tagName&&T(),null==m){const e=A("UL");e.onAttach=t.onUnorderedList,e.appendChild(A("LI")),m=e}else m.appendChild(A("LI"));R=m.lastChild,w=2,I=w,x=!0}}else if(c&&Number.isInteger(parseInt(O,10))){const e=/^([0-9]+)\. /.exec(B);if(e){const n=e[0].length;if(null!=m&&"OL"!==m.tagName&&T(),null==m){const e=A("OL");e.onAttach=t.onOrderedList,e.appendChild(A("LI")),m=e}else m.appendChild(A("LI"));R=m.lastChild,w=n,I=w,x=!0}}else if(" "===O&&" "===_(1)){const e=/^([ ]{2,})((- )|(\d+\. ))?/.exec(B),n=e[0].length,l=e[1].length,o=null!=e[2],s="- "===e[2]?"UL":"OL";if((!1===o&&null!=R&&null!=R.parentNode&&"UL"===R.parentNode.tagName&&l>=2||!1===o&&null!=R&&"OL"===R.parentNode.tagName&&l>=3)&&("LI"===R.tagName&&R.appendChild(A("BR")),w+=n,I+=n,x=!0),o&&null!=R&&null!=R.parentNode&&(r&&"UL"===m.tagName&&l>=2||p&&"OL"===m.tagName&&l>=3)){let e=0,l=R;for(;null!=l;)"UL"!==l.tagName&&"OL"!==l.tagName||(e+=1),l=l.parentNode;const o=R.parentNode,a=o.lastChild;if(2===e&&R.parentNode.tagName===s)o.appendChild(A("LI")),R=o.lastChild;else{const e=A(s);e.onAttach="UL"===s?t.onUnorderedList:t.onOrderedList,e.appendChild(A("LI")),a.appendChild(e),R=a.lastChild.lastChild}w=n,I=w,x=!0}}else if(h&&">"===O){if(" "===_(1)){if(null!=m&&"BLOCKQUOTE"===m.tagName||T(),null==m){const e=A("P"),n=A("BLOCKQUOTE");n.onAttach=t.onQuote,n.appendChild(e),m=n,R=e}w=2,I=w,x=!0}}else if(i&&B.startsWith("```")){const n=/^```(\w*)\n((.|\n(?!```))+)\n```/.exec(b.substring(L));if(n){T();const l=n[0].length,o=n[1],s=n[2],a=A("CODE");a.textContent=s.replace(/\\`/g,"`");const i=A("PRE");i.appendChild(a),i.onAttach=null!=t.onMultilineCode?e=>t.onMultilineCode(e,o):void 0,m=i,T(),E=l,e=!1}}if(e){let e;for(!1===x&&null!=m&&"P"!==m.tagName&&T(),null!=R&&"P"===R.tagName&&null!=R.firstChild&&R.appendChild(A("BR"));w<=g;){let n=0;const i=REGEX_MD_TEXT.exec(B.substring(w,e));if(null==i){if(null==e){w=B.length,U();break}for(w=e,U(),w+=R.ffOnTextEnd,I+=R.ffOnTextEnd;R.upOnTextEnd;)R=R.parentNode;R=R.parentNode,e=void 0}else{const d=i[0];if(n=1,w+=i.index,"\\"===_(-1));else if("*"===d)if("*"===_(1)&&"*"===_(2)){const t="***",l=t.length,o=w+l,s=B.substring(o).indexOf(t);if(s>0){U(),e=o+s;const t=A("EM");t.ffOnTextEnd=l,t.upOnTextEnd=!0;const a=A("STRONG");a.appendChild(t),R.appendChild(a),R=t,n=l,I+=l}}else if("*"===_(1)){const t="**",l=2,o=w+l,s=B.substring(o).indexOf(t);if(s>0){U(),e=o+s;const t=A("STRONG");t.ffOnTextEnd=l,R.appendChild(t),R=t,n=l,I+=l}}else{const t=1,l=w+t,o=B.substring(l).indexOf("*");if(o>0){U(),e=l+o;const s=A("EM");s.ffOnTextEnd=t,R.appendChild(s),R=s,n=t,I+=t}}else if("~"===d){if("~"===_(1)){const t="~~",l=t.length,o=w+l,s=B.substring(o).indexOf(t);if(s>0){U(),e=o+s;const t=A("S");t.ffOnTextEnd=l,R.appendChild(t),R=t,n=l,I+=l}}}else if("^"===d){const e=1,t=B.substring(w+e),l=("("===t[0]?/^\(([^)]+)\)/:/^(\w+)/).exec(t);if(l){U();const t=l[0].length,o=l[1],s=A("SUP");s.textContent=o,R.appendChild(s),n=e+t,I+=n}}else if("["===d){const e=B.substring(w+1);if(u&&"^"===_(1)){const l=/\^(\d+)]/.exec(e);if(l){U();const e=l[1],o=A("SUP");o.textContent=e;const s=A("A");s.setAttribute("href","#reference"+e),s.appendChild(o),s.onAttach=null!=t.onReference?n=>t.onReference(n,e):void 0,R.appendChild(s),n=1+l[0].length,I+=n}}else if(l){const l=/([^\]]+)]\(([^)]+)\)/.exec(e);if(l){U();const e=l[1],o=l[2],s=A("A");s.setAttribute("href",o),s.textContent=e,s.onAttach=t.onLink,R.appendChild(s),n=1+l[0].length,I+=n}}}else if("!"===d&&"["===_(1)){if(o){const e=B.substring(w+1),l=/^\[([^\]]+)]\(([^;)]+)\)({([^}]+)})?/.exec(e);if(l){U();const e=1+l[0].length,o=l[1],a=l[2],i=l[4],d=A("IMG");d.onAttach=t.onImage,d.setAttribute("src",a),d.setAttribute("alt",o),s&&null!=i&&d.setAttribute("style",i),R.appendChild(d),n=e,I+=n}}}else if(a&&"`"===d){const e=B.substring(w+1),l=e.indexOf("`");if(l>0){U();const o=e.substring(0,l),s=A("CODE");s.textContent=o,s.onAttach=t.onCode,R.appendChild(s),n=1+l+1,I+=n}}}w+=n}}}L+=E}return m&&T(),O};export default{parse:parse};