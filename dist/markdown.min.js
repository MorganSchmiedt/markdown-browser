/* eslint-disable */
const parseBoolean=(e,t)=>"boolean"==typeof e?e:t,parseMaxHeader=(e,t)=>Number.isInteger(e)&&e>=1&&e<=6?e:t,MD_ESCAPE_CHAR="\\",MD_CHARS=["*","[","`","!","#","~","^"].join(""),REGEX_ESCAPE_CHAR=new RegExp(`\\\\([${MD_CHARS}])`,"g"),removeEscapeChars=e=>e.replace(REGEX_ESCAPE_CHAR,(e,t)=>t),REGEX_MD_TEXT=new RegExp(`[${MD_CHARS}]`),attach=function(){for(const e of this.children)e._attach&&e._attach(e);this.onAttach&&this.onAttach(this)},parse=(e,t={})=>{const n=parseBoolean(t.allowHeader,!0),l=parseBoolean(t.allowLink,!0),o=parseBoolean(t.allowImage,!0),s=parseBoolean(t.allowImageStyle,!1),a=parseBoolean(t.allowCode,!0),i=parseBoolean(t.allowMultilineCode,!0),d=parseBoolean(t.allowUnorderedList,!0),r=parseBoolean(t.allowUnorderedNestedList,!0),c=parseBoolean(t.allowOrderedList,!0),p=parseBoolean(t.allowOrderedNestedList,!0),f=parseBoolean(t.allowHorizontalLine,!0),h=parseBoolean(t.allowQuote,!0),u=parseBoolean(t.allowFootnote,!1),C=(g=t.maxHeader,E=3,Number.isInteger(g)&&g>=1&&g<=6?g:E);var g,E;const x=t.document||window.document,A=e=>{const t=x.createElement(e);return t._attach=attach,t},O=x.createElement("div");let L=0;const m=e+"\n",b=m.length;let N,w,I,R,B;const T={},U=[],_=()=>{null!=N&&(O.appendChild(N),O.lastChild._attach(),N=null,w=null)},H=()=>{if(null==w&&(N=A("P"),w=N),I<R){const e=removeEscapeChars(B.substring(I,R));w.appendChild(x.createTextNode(e)),I=R}},M=e=>B[R+e];for(;L<b;){const e=m.substring(L),g=e.indexOf("\n");B=e.substring(0,g);let E=g+1,x=!1;if(0===B.trim().length)null!=N&&"P"===N.tagName&&_();else{R=0,I=0;let e=!0;const O=B[0];if("\\"===O)R=1;else if(n&&"#"===O){let n=1;for(;n<C&&"#"===M(n);)n+=1;if(" "===M(n)){_();const l=B.substring(B.indexOf(" ")+1),o=A("H"+n);o.textContent=l,o.onAttach=t.onHeader,N=o,e=!1,_()}}else if("!"===O){if("["===M(1)&&o){const n=B.substring(R+1),l=/^\[([^\]]+)]\(([^;)]+)(;([^)]+))?\)$/.exec(n);if(l){_();const n=l[1],o=l[2],a=l[4],i=A("FIGURE");s&&null!=a&&i.setAttribute("style",a);if(o.endsWith(".mp4")){const e=A("SOURCE");e.setAttribute("src",o),e.setAttribute("type","video/mp4");const n=A("VIDEO");n.appendChild(e),n.setAttribute("controls",""),n.onAttach=t.onVideo,i.appendChild(n)}else{const e=A("IMG");e.setAttribute("src",o),e.setAttribute("alt",""),e.onAttach=t.onImage,i.appendChild(e)}const d=A("FIGCAPTION");d.textContent=n,i.appendChild(d),N=i,e=!1,_()}}}else if("-"===O){if(f&&"---"===B&&"\n"===m[L-2]&&"\n"===m[L-1]&&"\n"===m[L+3]&&"\n"===m[L+4]){_();const n=A("HR");n.onAttach=t.onHorizontalLine,N=n,e=!1,_()}else if(d&&" "===M(1)){if(null!=N&&"UL"!==N.tagName&&_(),null==N){const e=A("UL");e.onAttach=t.onUnorderedList,e.appendChild(A("LI")),N=e}else N.appendChild(A("LI"));w=N.lastChild,R=2,I=R,x=!0}}else if(c&&Number.isInteger(parseInt(O,10))){const e=/^([0-9]+)\. /.exec(B);if(e){const n=e[0].length;if(null!=N&&"OL"!==N.tagName&&_(),null==N){const e=A("OL");e.onAttach=t.onOrderedList,e.appendChild(A("LI")),N=e}else N.appendChild(A("LI"));w=N.lastChild,R=n,I=R,x=!0}}else if(" "===O&&" "===M(1)){const e=/^([ ]{2,})((- )|(\d+\. ))?/.exec(B),n=e[0].length,l=e[1].length,o=null!=e[2],s="- "===e[2]?"UL":"OL";if((!1===o&&null!=w&&null!=w.parentNode&&"UL"===w.parentNode.tagName&&l>=2||!1===o&&null!=w&&"OL"===w.parentNode.tagName&&l>=3)&&("LI"===w.tagName&&w.appendChild(A("BR")),R+=n,I+=n,x=!0),o&&null!=w&&null!=w.parentNode&&(r&&"UL"===N.tagName&&l>=2||p&&"OL"===N.tagName&&l>=3)){let e=0,l=w;for(;null!=l;)"UL"!==l.tagName&&"OL"!==l.tagName||(e+=1),l=l.parentNode;const o=w.parentNode,a=o.lastChild;if(2===e&&w.parentNode.tagName===s)o.appendChild(A("LI")),w=o.lastChild;else{const e=A(s);e.onAttach="UL"===s?t.onUnorderedList:t.onOrderedList,e.appendChild(A("LI")),a.appendChild(e),w=a.lastChild.lastChild}R=n,I=R,x=!0}}else if(h&&">"===O){if(" "===M(1)){if(null!=N&&"BLOCKQUOTE"===N.tagName||_(),null==N){const e=A("P"),n=A("BLOCKQUOTE");n.onAttach=t.onQuote,n.appendChild(e),N=n,w=e}R=2,I=R,x=!0}}else if(i&&B.startsWith("```")){const n=/^```(\w*)\n((.|\n(?!```))+)\n```/.exec(m.substring(L));if(n){_();const l=n[0].length,o=n[1],s=n[2],a=A("CODE");a.textContent=s.replace(/\\`/g,"`");const i=A("PRE");i.appendChild(a),i.onAttach=null!=t.onMultilineCode?e=>t.onMultilineCode(e,o):void 0,N=i,_(),E=l,e=!1}}else if(u&&"["===O){const t=/^\[\^([\d\w]+)\]: (.+)/.exec(B);if(t){_();const n=t[1],l=t[2];T[n]=l,e=!1}}if(e){let e;for(!1===x&&null!=N&&"P"!==N.tagName&&_(),null!=w&&"P"===w.tagName&&null!=w.firstChild&&w.appendChild(A("BR"));R<=g;){let n=0;const i=REGEX_MD_TEXT.exec(B.substring(R,e));if(null==i){if(null==e){R=B.length,H();break}for(R=e,H(),R+=w.ffOnTextEnd,I+=w.ffOnTextEnd;w.upOnTextEnd;)w=w.parentNode;w=w.parentNode,e=void 0}else{const d=i[0];if(n=1,R+=i.index,"\\"===M(-1));else if("*"===d)if("*"===M(1)&&"*"===M(2)){const t="***",l=t.length,o=R+l,s=B.substring(o).indexOf(t);if(s>0){H(),e=o+s;const t=A("EM");t.ffOnTextEnd=l,t.upOnTextEnd=!0;const a=A("STRONG");a.appendChild(t),w.appendChild(a),w=t,n=l,I+=l}}else if("*"===M(1)){const t="**",l=2,o=R+l,s=B.substring(o).indexOf(t);if(s>0){H(),e=o+s;const t=A("STRONG");t.ffOnTextEnd=l,w.appendChild(t),w=t,n=l,I+=l}}else{const t=1,l=R+t,o=B.substring(l).indexOf("*");if(o>0){H(),e=l+o;const s=A("EM");s.ffOnTextEnd=t,w.appendChild(s),w=s,n=t,I+=t}}else if("~"===d){if("~"===M(1)){const t="~~",l=t.length,o=R+l,s=B.substring(o).indexOf(t);if(s>0){H(),e=o+s;const t=A("S");t.ffOnTextEnd=l,w.appendChild(t),w=t,n=l,I+=l}}}else if("^"===d){const e=1,t=B.substring(R+e),l=("("===t[0]?/^\(([^)]+)\)/:/^(\w+)/).exec(t);if(l){H();const t=l[0].length,o=l[1],s=A("SUP");s.textContent=o,w.appendChild(s),n=e+t,I+=n}}else if("["===d){const e=B.substring(R+1);if(u&&"^"===M(1)){const l=/\^([\d\w]+)]/.exec(e);if(l){H();const e=l[1],o=U.length+1;U.push(e);const s=A("SUP");s.textContent=o;const a=A("A");a.setAttribute("href","#reference"+o),a.appendChild(s),a.onAttach=null!=t.onReference?n=>t.onReference(n,e):void 0,w.appendChild(a),n=1+l[0].length,I+=n}}else if(l){const l=/([^\]]+)]\(([^)]+)\)/.exec(e);if(l){H();const e=l[1],o=l[2],s=A("A");s.setAttribute("href",o),s.textContent=e,s.onAttach=t.onLink,w.appendChild(s),n=1+l[0].length,I+=n}}}else if("!"===d&&"["===M(1)){if(o){const e=B.substring(R+1),l=/^\[([^\]]+)]\(([^;)]+)\)({([^}]+)})?/.exec(e);if(l){H();const e=1+l[0].length,o=l[1],a=l[2],i=l[4],d=A("IMG");d.onAttach=t.onImage,d.setAttribute("src",a),d.setAttribute("alt",o),s&&null!=i&&d.setAttribute("style",i),w.appendChild(d),n=e,I+=n}}}else if(a&&"`"===d){const e=B.substring(R+1),l=e.indexOf("`");if(l>0){H();const o=e.substring(0,l),s=A("CODE");s.textContent=o,s.onAttach=t.onCode,w.appendChild(s),n=1+l+1,I+=n}}}R+=n}}}L+=E}if(N&&_(),u){const e=x.createElement("section");let n=1;for(const l of U){const o=T[l];if(null!=o){const l=x.createElement("sup");l.id="reference"+n,l.textContent=n;const s=parse(o,Object.assign({},t,{allowHeader:!1,allowImage:!1,allowMultilineCode:!1,allowUnorderedList:!1,allowOrderedList:!1,allowHorizontalLine:!1,allowQuote:!1,allowFootnote:!1})).firstChild,a=x.createElement("p");a.appendChild(l);for(const e of Array.from(s.childNodes))a.appendChild(e);e.appendChild(a),n+=1}}e.children.length>0&&O.appendChild(e)}return O};export default{parse:parse};