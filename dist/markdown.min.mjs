/* eslint-disable */
const e=(e,t)=>"boolean"==typeof e?e:t,t=["*","[","`","!","#","~","^"].join(""),n=new RegExp(`\\\\([${t}])`,"g"),l=new RegExp(`[${t}]`),o=e=>/^\s$/.test(e),i=(e,t)=>{let n=0;for(;n<t.length;){const l=t.substring(n),o=/^([^=]+)=(?:"([^"]+)"|([^;]+))?/.exec(l);if(null==o)return;const i=o[1],s=o[2]||o[3];e.setAttribute(i,s),n+=o[0].length+1}},s=function(){for(const e of this.children)e._attach&&e._attach(e);this.onAttach&&this.onAttach(this)},a=(t,d={})=>{const c=e(d.allowHeader,!0),r=e(d.allowLink,!0),f=e(d.allowImage,!0),p=e(d.allowCode,!0),h=e(d.allowMultilineCode,!0),u=e(d.allowUnorderedList,!0),C=e(d.allowUnorderedNestedList,!0),g=e(d.allowOrderedList,!0),O=e(d.allowOrderedNestedList,!0),L=e(d.allowHorizontalLine,!0),x=e(d.allowQuote,!0),N=e(d.allowFootnote,!1),A=e(d.allowHTMLAttributes,!1),b=(m=d.maxHeader,w=3,Number.isInteger(m)&&m>=1&&m<=6?m:w);var m,w;const E=d.document||window.document,I=e=>{const t=E.createElement(e);return t._attach=s,t},U=E.createElement("div");let T=0;const R=`${t}\n`,M=R.length;let H,P,S,$,G;const v={},Q=new Set,y=new Map,B=()=>{null!=H&&(U.appendChild(H),U.lastChild._attach(),H=null,P=null)},k=()=>{if(null==P&&(H=I("P"),P=H),S<$){const e=(e=>e.replace(n,((e,t)=>t)))(G.substring(S,$));P.appendChild(E.createTextNode(e)),S=$}},z=e=>G[$+e];for(;T<M;){const e=R.substring(T),t=e.indexOf("\n");G=e.substring(0,t);let n=t+1,s=!1;if(0===G.trim().length)null!=H&&"P"===H.tagName&&B();else{$=0,S=0;let e=!0;const a=G[0];if("\\"===a)$=1;else if(c&&"#"===a){let t=1;for(;t<b&&"#"===z(t);)t+=1;if(" "===z(t)){B();const n=G.substring(G.indexOf(" ")+1),l=I(`H${t}`);l.textContent=n,l.onAttach=d.onHeader,H=l,e=!1,B()}}else if("!"===a){if("["===z(1)&&f){const t=G.substring($+1),n=/^\[([^\]]+)]\(([^;)]+)\)(?:{([^}]+)})?$/.exec(t);if(n){B();const t=n[1],l=n[2],o=n[3],s=I("FIGURE");if(A&&null!=o&&i(s,o),l.endsWith(".mp3")){const e=I("SOURCE");e.setAttribute("src",l),e.setAttribute("type","audio/mpeg");const t=I("AUDIO");t.appendChild(e),t.setAttribute("controls",""),t.onAttach=d.onAudio,s.appendChild(t)}else if(l.endsWith(".mp4")){const e=I("SOURCE");e.setAttribute("src",l),e.setAttribute("type","video/mp4");const t=I("VIDEO");t.appendChild(e),t.setAttribute("controls",""),t.onAttach=d.onVideo,s.appendChild(t)}else{const e=I("IMG");e.setAttribute("src",l),e.setAttribute("alt",""),e.onAttach=d.onImage,s.appendChild(e)}const a=I("FIGCAPTION");a.textContent=t,s.appendChild(a),H=s,e=!1,B()}}}else if("-"===a){if(L&&"---"===G&&"\n"===R[T-2]&&"\n"===R[T-1]&&"\n"===R[T+3]&&"\n"===R[T+4]){B();const t=I("HR");t.onAttach=d.onHorizontalLine,H=t,e=!1,B()}else if(u&&" "===z(1)){if(null!=H&&"UL"!==H.tagName&&B(),null==H){const e=I("UL");e.onAttach=d.onUnorderedList,e.appendChild(I("LI")),H=e}else H.appendChild(I("LI"));P=H.lastChild,$=2,S=$,s=!0}}else if(g&&Number.isInteger(parseInt(a,10))){const e=/^([0-9]+)\. /.exec(G);if(e){const t=e[0].length;if(null!=H&&"OL"!==H.tagName&&B(),null==H){const e=I("OL");e.onAttach=d.onOrderedList,e.appendChild(I("LI")),H=e}else H.appendChild(I("LI"));P=H.lastChild,$=t,S=$,s=!0}}else if(" "===a&&" "===z(1)){const e=/^([ ]{2,})((- )|(\d+\. ))?/.exec(G),t=e[0].length,n=e[1].length,l=null!=e[2],o="- "===e[2]?"UL":"OL";if((!1===l&&null!=P&&null!=P.parentNode&&"UL"===P.parentNode.tagName&&n>=2||!1===l&&null!=P&&null!=P.parentNode&&"OL"===P.parentNode.tagName&&n>=3)&&("LI"===P.tagName&&P.appendChild(I("BR")),$+=t,S+=t,s=!0),l&&null!=P&&null!=P.parentNode&&(C&&"UL"===H.tagName&&n>=2||O&&"OL"===H.tagName&&n>=3)){let e=0,n=P;for(;null!=n;)"UL"!==n.tagName&&"OL"!==n.tagName||(e+=1),n=n.parentNode;const l=P.parentNode,i=l.lastChild;if(2===e&&P.parentNode.tagName===o)l.appendChild(I("LI")),P=l.lastChild;else{const e=I(o);e.onAttach="UL"===o?d.onUnorderedList:d.onOrderedList,e.appendChild(I("LI")),i.appendChild(e),P=i.lastChild.lastChild}$=t,S=$,s=!0}}else if(x&&">"===a){if(" "===z(1)){if(null!=H&&"BLOCKQUOTE"===H.tagName||B(),null==H){const e=I("P"),t=I("BLOCKQUOTE");t.onAttach=d.onQuote,t.appendChild(e),H=t,P=e}else if("BLOCKQUOTE"===H.tagName&&1===G.trim().length){const e=I("P");H.appendChild(e),P=e}$=2,S=$,s=!0}}else if(h&&G.startsWith("```")){const t=/^```(\w*)\n((.|\n(?!```))+)\n```/.exec(R.substring(T));if(t){B();const l=t[0].length,o=t[1],i=t[2],s=I("CODE");s.textContent=i.replace(/\\`/g,"`");const a=I("PRE");a.appendChild(s),a.onAttach=null!=d.onMultilineCode?e=>d.onMultilineCode(e,o):void 0,H=a,B(),n=l,e=!1}}else if(N&&"["===a){const t=/^\[\^([\d\w]+)\]: (.+)/.exec(G);if(t){B();const n=t[1],l=t[2];v[n]=l,e=!1}}if(e){let e;for(!1===s&&null!=H&&"P"!==H.tagName&&B(),null!=P&&"P"===P.tagName&&null!=P.firstChild&&P.appendChild(I("BR"));$<=t;){let t=0;const n=l.exec(G.substring($,e));if(null==n){if(null==e){$=G.length,k();break}for($=e,k(),$+=P.ffOnTextEnd,S+=P.ffOnTextEnd;P.upOnTextEnd;)P=P.parentNode;P=P.parentNode,e=void 0}else{const l=n[0];if(t=1,$+=n.index,"\\"===z(-1));else if("*"===l){if(null==P||"EM"!==P.tagName&&"STRONG"!==P.tagName){const n=G.substring($),l=/^(\*{1,3})/.exec(n)[0],i=l.length,s=n[i];if(!1===o(s)){const t=/(.+?)(?=\S\*)/.exec(n.substr(i));if(t){const n=t[0].length+i+1;if(k(),e=$+n,"*"===l){const e=I("EM");e.ffOnTextEnd=i,P.appendChild(e),P=e}else if("**"===l){const e=I("STRONG");e.ffOnTextEnd=i,P.appendChild(e),P=e}else{const e=I("EM");e.ffOnTextEnd=i,e.upOnTextEnd=!0;const t=I("STRONG");t.appendChild(e),P.appendChild(t),P=e}S+=i}}t=i}}else if("~"===l){if("~"===z(1)){const n="~~",l=n.length,o=$+l,i=G.substring(o).indexOf(n);if(i>0){k(),e=o+i;const n=I("S");n.ffOnTextEnd=l,P.appendChild(n),P=n,t=l,S+=l}}}else if("^"===l){const e=1,n=G.substring($+e),l=("("===n[0]?/^\(([^)]+)\)/:/^(\w+)/).exec(n);if(l){k();const n=l[0].length,o=l[1],i=I("SUP");i.textContent=o,P.appendChild(i),t=e+n,S+=t}}else if("["===l){const e=G.substring($+1);if(N&&"^"===z(1)){const n=/\^([\d\w]+)]/.exec(e);if(n){k();const e=n[1];let l;!1===Q.has(e)?(Q.add(e),l=Q.size,y.set(e,l)):l=y.get(e);const o=I("SUP");o.textContent=l;const i=I("A");i.setAttribute("href",`#reference${l}`),i.appendChild(o),i.onAttach=null!=d.onReference?t=>d.onReference(t,e):void 0,P.appendChild(i),t=1+n[0].length,S+=t}}else if(r){const n=/([^\]]+)]\(([^)]+)\)/.exec(e);if(n){k();const e=n[1],l=n[2],o=I("A");o.setAttribute("href",l),o.textContent=e,o.onAttach=d.onLink,P.appendChild(o),t=1+n[0].length,S+=t}}}else if("!"===l&&"["===z(1)){if(f){const e=G.substring($+1),n=/^\[([^\]]+)]\(([^;)]+)\)(?:{([^}]+)})?/.exec(e);if(n){k();const e=1+n[0].length,l=n[1],o=n[2],s=n[3],a=I("IMG");a.onAttach=d.onImage,a.setAttribute("src",o),a.setAttribute("alt",l),A&&null!=s&&i(a,s),P.appendChild(a),t=e,S+=t}}}else if(p&&"`"===l){const e=G.substring($+1),n=e.indexOf("`");if(n>0){k();const l=e.substring(0,n),o=I("CODE");o.textContent=l,o.onAttach=d.onCode,P.appendChild(o),t=1+n+1,S+=t}}}$+=t}}}T+=n}if(H&&B(),N){const e=I("ol");let t=1;for(const n of Q.keys()){const l=v[n];if(null!=l){const n=a(l,Object.assign({},d,{allowHeader:!1,allowImage:!1,allowMultilineCode:!1,allowUnorderedList:!1,allowOrderedList:!1,allowHorizontalLine:!1,allowQuote:!1,allowFootnote:!1})).firstChild,o=I("li");o.id=`reference${t}`;for(const e of Array.from(n.childNodes))o.appendChild(e);e.appendChild(o),t+=1}}if(e.children.length>0){const t=I("section");t.appendChild(e),U.appendChild(t)}}return U};export default{parse:a};